

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Epilepsy Detection Using EEG Data &mdash; cesium vUndefined documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/output_cells.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="cesium vUndefined documentation" href="../index.html"/>
        <link rel="up" title="Examples" href="index.html"/>
        <link rel="next" title="API Reference" href="../api/api.html"/>
        <link rel="prev" title="Examples" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> cesium
          

          
          </a>

          
            
            
              <div class="version">
                vUndefined
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature_table.html">Time-Series Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Epilepsy Detection Using EEG Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#featurization">Featurization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-feature-functions">Custom feature functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multi-channel-time-series">Multi-channel time series</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-building">Model Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prediction">Prediction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cesium</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Examples</a> &raquo;</li>
        
      <li>Epilepsy Detection Using EEG Data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="epilepsy-detection-using-eeg-data">
<span id="sphx-glr-auto-examples-plot-eeg-example-py"></span><h1>Epilepsy Detection Using EEG Data<a class="headerlink" href="#epilepsy-detection-using-eeg-data" title="Permalink to this headline">¶</a></h1>
<p>In this example we’ll use the <a class="reference external" href="https://github.com/cesium-ml/cesium"><code class="docutils literal"><span class="pre">cesium</span></code></a> library to compare
various techniques for epilepsy detection using a classic EEG time series dataset from
<a class="reference external" href="http://www.meb.uni-bonn.de/epileptologie/science/physik/eegdata.html">Andrzejak et al.</a>.
The raw data are separated into five classes: Z, O, N, F, and S; we will consider a
three-class classification problem of distinguishing normal (Z, O), interictal (N, F), and
ictal (S) signals.</p>
<p>The overall workflow consists of three steps: first, we “featurize” the time series by
selecting some set of mathematical functions to apply to each; next, we build some
classification models which use these features to distinguish between classes;
finally, we validate our models by generating predictions for some unseen
holdout set and comparing them to the true class labels.</p>
<p>First, we’ll load the data and inspect a representative time series from each class:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span><span class="p">;</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">cesium</span> <span class="kn">import</span> <span class="n">datasets</span>

<span class="n">eeg</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_andrzejak</span><span class="p">()</span>

<span class="c1"># Group together classes (Z, O), (N, F), (S) as normal, interictal, ictal</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;U16&quot;</span><span class="p">)</span> <span class="c1">#  allocate memory for longer class names</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;O&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;F&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;Interictal&quot;</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ictal&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">])),</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]),</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">subplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">subplot</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time (s)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;signal&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_EEG_Example_001.png" class="align-center" src="../_images/sphx_glr_plot_EEG_Example_001.png" />
<div class="section" id="featurization">
<h2>Featurization<a class="headerlink" href="#featurization" title="Permalink to this headline">¶</a></h2>
<p>Once the data is loaded, we can generate features for each time series using the
<a class="reference external" href="http://cesium-ml.org/docs/api/cesium.featurize.html"><code class="docutils literal"><span class="pre">cesium.featurize</span></code></a> module. The <code class="docutils literal"><span class="pre">featurize</span></code> module includes many built-in
choices of features which can be applied for any type of time series data;
here we’ve chosen a few generic features that do not have any special
biological significance.</p>
<p>By default, the time series will featurized in parallel using the
<code class="docutils literal"><span class="pre">dask.threaded</span></code> scheduler; other approaches, including serial and
distributed approaches, can be implemented by passing in other <code class="docutils literal"><span class="pre">dask</span></code>
schedulers as the <code class="docutils literal"><span class="pre">get</span></code> argument to <code class="docutils literal"><span class="pre">featurize_time_series</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cesium</span> <span class="kn">import</span> <span class="n">featurize</span>
<span class="n">features_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;percent_beyond_1_std&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;maximum&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;max_slope&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;median&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;median_absolute_deviation&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;percent_close_to_median&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;minimum&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;skew&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;std&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;weighted_average&quot;</span><span class="p">]</span>
<span class="n">fset_cesium</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span>
                                              <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">],</span>
                                              <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                              <span class="n">features_to_use</span><span class="o">=</span><span class="n">features_to_use</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fset_cesium</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">feature</span> <span class="n">amplitude</span> <span class="n">percent_beyond_1_std</span> <span class="n">maximum</span>     <span class="n">max_slope</span> <span class="n">median</span>  \
<span class="n">channel</span>         <span class="mi">0</span>                    <span class="mi">0</span>       <span class="mi">0</span>             <span class="mi">0</span>      <span class="mi">0</span>
<span class="mi">0</span>           <span class="mf">143.5</span>             <span class="mf">0.162558</span>   <span class="mf">141.0</span>  <span class="mf">11107.796610</span>   <span class="o">-</span><span class="mf">4.0</span>
<span class="mi">1</span>           <span class="mf">211.5</span>             <span class="mf">0.145472</span>   <span class="mf">169.0</span>  <span class="mf">20653.559322</span>  <span class="o">-</span><span class="mf">51.0</span>
<span class="mi">2</span>           <span class="mf">165.0</span>             <span class="mf">0.152307</span>   <span class="mf">184.0</span>  <span class="mf">13537.627119</span>   <span class="mf">13.0</span>
<span class="mi">3</span>           <span class="mf">171.5</span>             <span class="mf">0.152307</span>   <span class="mf">162.0</span>  <span class="mf">17008.813559</span>   <span class="o">-</span><span class="mf">4.0</span>
<span class="mi">4</span>           <span class="mf">170.0</span>             <span class="mf">0.152062</span>   <span class="mf">152.0</span>  <span class="mf">13016.949153</span>  <span class="o">-</span><span class="mf">18.0</span>

<span class="n">feature</span> <span class="n">median_absolute_deviation</span> <span class="n">percent_close_to_median</span> <span class="n">minimum</span>      <span class="n">skew</span>  \
<span class="n">channel</span>                         <span class="mi">0</span>                       <span class="mi">0</span>       <span class="mi">0</span>         <span class="mi">0</span>
<span class="mi">0</span>                            <span class="mf">28.0</span>                <span class="mf">0.505004</span>  <span class="o">-</span><span class="mf">146.0</span>  <span class="mf">0.032805</span>
<span class="mi">1</span>                            <span class="mf">32.0</span>                <span class="mf">0.640469</span>  <span class="o">-</span><span class="mf">254.0</span> <span class="o">-</span><span class="mf">0.092715</span>
<span class="mi">2</span>                            <span class="mf">31.0</span>                <span class="mf">0.515987</span>  <span class="o">-</span><span class="mf">146.0</span> <span class="o">-</span><span class="mf">0.004100</span>
<span class="mi">3</span>                            <span class="mf">31.0</span>                <span class="mf">0.541128</span>  <span class="o">-</span><span class="mf">181.0</span>  <span class="mf">0.063678</span>
<span class="mi">4</span>                            <span class="mf">29.0</span>                <span class="mf">0.566268</span>  <span class="o">-</span><span class="mf">188.0</span>  <span class="mf">0.142753</span>

<span class="n">feature</span>        <span class="n">std</span> <span class="n">weighted_average</span>
<span class="n">channel</span>          <span class="mi">0</span>                <span class="mi">0</span>
<span class="mi">0</span>        <span class="mf">40.411000</span>        <span class="o">-</span><span class="mf">4.132048</span>
<span class="mi">1</span>        <span class="mf">48.812668</span>       <span class="o">-</span><span class="mf">52.444716</span>
<span class="mi">2</span>        <span class="mf">47.144789</span>        <span class="mf">12.705150</span>
<span class="mi">3</span>        <span class="mf">47.072316</span>        <span class="o">-</span><span class="mf">3.992433</span>
<span class="mi">4</span>        <span class="mf">44.910958</span>       <span class="o">-</span><span class="mf">17.999268</span>
</pre></div>
</div>
<p>The output of <code class="docutils literal"><span class="pre">featurize_time_series</span></code> is a <code class="docutils literal"><span class="pre">pandas.DataFrame</span></code> which contains all
the feature information needed to train a machine learning model: feature
names are stored as column indices (as well as channel numbers, as we’ll see
later for multi-channel data), and the time series index/class label are
stored as row indices.</p>
<div class="section" id="custom-feature-functions">
<h3>Custom feature functions<a class="headerlink" href="#custom-feature-functions" title="Permalink to this headline">¶</a></h3>
<p>Custom feature functions not built into <code class="docutils literal"><span class="pre">cesium</span></code> may be passed in using the
<code class="docutils literal"><span class="pre">custom_functions</span></code> keyword, either as a dictionary <code class="docutils literal"><span class="pre">{feature_name:</span> <span class="pre">function}</span></code>, or as a
<a class="reference external" href="http://dask.pydata.org/en/latest/custom-graphs.html">dask graph</a>. Functions should take
three arrays <code class="docutils literal"><span class="pre">times,</span> <span class="pre">measurements,</span> <span class="pre">errors</span></code> as inputs; details can be found in the
<code class="docutils literal"><span class="pre">cesium.featurize</span></code>
<a class="reference external" href="http://cesium-ml.org/docs/api/cesium.featurize.html">documentation</a>.
Here we’ll compute five standard features for EEG analysis provided by
<a class="reference external" href="http://linkinghub.elsevier.com/retrieve/pii/S0957417411003253)">Guo et al. (2012)</a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="k">def</span> <span class="nf">mean_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">std_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mean_square_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">abs_diffs_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">skew_signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we’ll pass the desired feature functions as a dictionary via the
<code class="docutils literal"><span class="pre">custom_functions</span></code> keyword argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">guo_features</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">mean_signal</span><span class="p">,</span>
    <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">std_signal</span><span class="p">,</span>
    <span class="s2">&quot;mean2&quot;</span><span class="p">:</span> <span class="n">mean_square_signal</span><span class="p">,</span>
    <span class="s2">&quot;abs_diffs&quot;</span><span class="p">:</span> <span class="n">abs_diffs_signal</span><span class="p">,</span>
    <span class="s2">&quot;skew&quot;</span><span class="p">:</span> <span class="n">skew_signal</span>
<span class="p">}</span>

<span class="n">fset_guo</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">],</span>
                                           <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                           <span class="n">features_to_use</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">guo_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                           <span class="n">custom_functions</span><span class="o">=</span><span class="n">guo_features</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fset_guo</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">feature</span>       <span class="n">mean</span>        <span class="n">std</span>        <span class="n">mean2</span> <span class="n">abs_diffs</span>      <span class="n">skew</span>
<span class="n">channel</span>          <span class="mi">0</span>          <span class="mi">0</span>            <span class="mi">0</span>         <span class="mi">0</span>         <span class="mi">0</span>
<span class="mi">0</span>        <span class="o">-</span><span class="mf">4.132048</span>  <span class="mf">40.411000</span>  <span class="mf">1650.122773</span>   <span class="mf">46948.0</span>  <span class="mf">0.032805</span>
<span class="mi">1</span>       <span class="o">-</span><span class="mf">52.444716</span>  <span class="mf">48.812668</span>  <span class="mf">5133.124725</span>   <span class="mf">61118.0</span> <span class="o">-</span><span class="mf">0.092715</span>
<span class="mi">2</span>        <span class="mf">12.705150</span>  <span class="mf">47.144789</span>  <span class="mf">2384.051989</span>   <span class="mf">51269.0</span> <span class="o">-</span><span class="mf">0.004100</span>
<span class="mi">3</span>        <span class="o">-</span><span class="mf">3.992433</span>  <span class="mf">47.072316</span>  <span class="mf">2231.742495</span>   <span class="mf">75014.0</span>  <span class="mf">0.063678</span>
<span class="mi">4</span>       <span class="o">-</span><span class="mf">17.999268</span>  <span class="mf">44.910958</span>  <span class="mf">2340.967781</span>   <span class="mf">52873.0</span>  <span class="mf">0.142753</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-channel-time-series">
<h3>Multi-channel time series<a class="headerlink" href="#multi-channel-time-series" title="Permalink to this headline">¶</a></h3>
<p>The EEG time series considered here consist of univariate signal measurements along a
uniform time grid. But <code class="docutils literal"><span class="pre">featurize_time_series</span></code> also accepts multi-channel
data; to demonstrate this, we will decompose each signal into five frequency
bands using a discrete wavelet transform as suggested by
<a class="reference external" href="http://www.sciencedirect.com/science/article/pii/S0957417404001745">Subasi (2005)</a>,
and then featurize each band separately using the five functions from above.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pywt</span>

<span class="n">n_channels</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;dwts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pywt</span><span class="o">.</span><span class="n">wavedec</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">pywt</span><span class="o">.</span><span class="n">Wavelet</span><span class="p">(</span><span class="s2">&quot;db1&quot;</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="n">n_channels</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;measurements&quot;</span><span class="p">]]</span>
<span class="n">fset_dwt</span> <span class="o">=</span> <span class="n">featurize</span><span class="o">.</span><span class="n">featurize_time_series</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;dwts&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                           <span class="n">features_to_use</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">guo_features</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                                           <span class="n">custom_functions</span><span class="o">=</span><span class="n">guo_features</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">fset_dwt</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">feature</span>        <span class="n">mean</span>                                                 <span class="n">std</span>  \
<span class="n">channel</span>           <span class="mi">0</span>         <span class="mi">1</span>         <span class="mi">2</span>         <span class="mi">3</span>         <span class="mi">4</span>           <span class="mi">0</span>
<span class="mi">0</span>        <span class="o">-</span><span class="mf">17.080739</span> <span class="o">-</span><span class="mf">6.067121</span> <span class="o">-</span><span class="mf">0.979336</span>  <span class="mf">0.154634</span>  <span class="mf">0.035545</span>  <span class="mf">112.473774</span>
<span class="mi">1</span>       <span class="o">-</span><span class="mf">210.210117</span> <span class="o">-</span><span class="mf">3.743191</span>  <span class="mf">0.511377</span>  <span class="mf">0.057561</span> <span class="o">-</span><span class="mf">0.024847</span>  <span class="mf">119.836067</span>
<span class="mi">2</span>         <span class="mf">51.831712</span>  <span class="mf">0.714981</span>  <span class="mf">0.247418</span> <span class="o">-</span><span class="mf">0.101951</span>  <span class="mf">0.007937</span>  <span class="mf">134.809626</span>
<span class="mi">3</span>        <span class="o">-</span><span class="mf">15.429961</span>  <span class="mf">9.348249</span> <span class="o">-</span><span class="mf">0.099243</span> <span class="o">-</span><span class="mf">0.228293</span>  <span class="mf">0.181522</span>  <span class="mf">104.420503</span>
<span class="mi">4</span>        <span class="o">-</span><span class="mf">71.982490</span> <span class="o">-</span><span class="mf">3.787938</span> <span class="o">-</span><span class="mf">0.183324</span> <span class="o">-</span><span class="mf">0.034146</span> <span class="o">-</span><span class="mf">0.048314</span>  <span class="mf">124.012203</span>

<span class="n">feature</span>                                                <span class="o">...</span>    <span class="n">abs_diffs</span>  \
<span class="n">channel</span>          <span class="mi">1</span>          <span class="mi">2</span>          <span class="mi">3</span>          <span class="mi">4</span>    <span class="o">...</span>            <span class="mi">0</span>
<span class="mi">0</span>        <span class="mf">72.970862</span>  <span class="mf">48.167301</span>  <span class="mf">25.774846</span>  <span class="mf">10.154899</span>    <span class="o">...</span>     <span class="mf">25127.00</span>
<span class="mi">1</span>        <span class="mf">92.777487</span>  <span class="mf">67.005780</span>  <span class="mf">33.957464</span>  <span class="mf">13.673398</span>    <span class="o">...</span>     <span class="mf">28742.00</span>
<span class="mi">2</span>        <span class="mf">78.294247</span>  <span class="mf">60.275759</span>  <span class="mf">28.088980</span>  <span class="mf">11.246134</span>    <span class="o">...</span>     <span class="mf">28284.75</span>
<span class="mi">3</span>        <span class="mf">89.999242</span>  <span class="mf">67.249397</span>  <span class="mf">35.929621</span>  <span class="mf">16.366747</span>    <span class="o">...</span>     <span class="mf">24848.25</span>
<span class="mi">4</span>        <span class="mf">73.870175</span>  <span class="mf">59.986686</span>  <span class="mf">27.599723</span>  <span class="mf">11.655378</span>    <span class="o">...</span>     <span class="mf">23848.25</span>

<span class="n">feature</span>                                                     <span class="n">skew</span>            \
<span class="n">channel</span>         <span class="mi">1</span>             <span class="mi">2</span>        <span class="mi">3</span>             <span class="mi">4</span>         <span class="mi">0</span>         <span class="mi">1</span>
<span class="mi">0</span>        <span class="mf">18056.00</span>  <span class="mf">32408.117995</span>  <span class="mf">34239.0</span>  <span class="mf">19883.842687</span> <span class="o">-</span><span class="mf">0.043301</span>  <span class="mf">0.065784</span>
<span class="mi">1</span>        <span class="mf">25226.00</span>  <span class="mf">44392.163723</span>  <span class="mf">45330.5</span>  <span class="mf">26138.909273</span> <span class="o">-</span><span class="mf">0.286254</span> <span class="o">-</span><span class="mf">0.016437</span>
<span class="mi">2</span>        <span class="mf">19826.25</span>  <span class="mf">42874.712570</span>  <span class="mf">36283.0</span>  <span class="mf">21020.163284</span>  <span class="mf">0.042923</span> <span class="o">-</span><span class="mf">0.121195</span>
<span class="mi">3</span>        <span class="mf">25715.25</span>  <span class="mf">43004.466665</span>  <span class="mf">47952.0</span>  <span class="mf">34686.416044</span>  <span class="mf">0.177416</span>  <span class="mf">0.214529</span>
<span class="mi">4</span>        <span class="mf">18328.75</span>  <span class="mf">39809.051121</span>  <span class="mf">35455.5</span>  <span class="mf">22640.144920</span>  <span class="mf">0.220502</span> <span class="o">-</span><span class="mf">0.077603</span>

<span class="n">feature</span>
<span class="n">channel</span>         <span class="mi">2</span>         <span class="mi">3</span>         <span class="mi">4</span>
<span class="mi">0</span>        <span class="mf">0.299892</span>  <span class="mf">0.123948</span>  <span class="mf">0.117937</span>
<span class="mi">1</span>        <span class="mf">0.168179</span> <span class="o">-</span><span class="mf">0.005521</span>  <span class="mf">0.187815</span>
<span class="mi">2</span>       <span class="o">-</span><span class="mf">0.254241</span> <span class="o">-</span><span class="mf">0.061304</span> <span class="o">-</span><span class="mf">0.136422</span>
<span class="mi">3</span>       <span class="o">-</span><span class="mf">0.013705</span> <span class="o">-</span><span class="mf">0.007339</span>  <span class="mf">0.013836</span>
<span class="mi">4</span>        <span class="mf">0.285906</span>  <span class="mf">0.087555</span>  <span class="mf">0.066677</span>

<span class="p">[</span><span class="mi">5</span> <span class="n">rows</span> <span class="n">x</span> <span class="mi">25</span> <span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
<p>The output featureset has the same form as before, except now the <code class="docutils literal"><span class="pre">channel</span></code>
component of the column index is used to index the features by the
corresponding frequency band.</p>
</div>
</div>
<div class="section" id="model-building">
<h2>Model Building<a class="headerlink" href="#model-building" title="Permalink to this headline">¶</a></h2>
<p>Featuresets produced by <code class="docutils literal"><span class="pre">cesium.featurize</span></code> are compatible with the <code class="docutils literal"><span class="pre">scikit-learn</span></code>
API. For this example, we’ll test a random forest classifier for the
built-in <code class="docutils literal"><span class="pre">cesium</span></code> features, and a 3-nearest neighbors classifier for the
others, as suggested by
<a class="reference external" href="http://linkinghub.elsevier.com/retrieve/pii/S0957417411003253">Guo et al. (2012)</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">])),</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">model_cesium</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                                      <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">model_cesium</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fset_cesium</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">])</span>

<span class="n">model_guo</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">model_guo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fset_guo</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">])</span>

<span class="n">model_dwt</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">model_dwt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fset_dwt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="prediction">
<h2>Prediction<a class="headerlink" href="#prediction" title="Permalink to this headline">¶</a></h2>
<p>Making predictions for new time series based on these models follows the same
pattern: first the time series are featurized using <code class="docutils literal"><span class="pre">featurize_time_series</span></code>,
and then predictions are made based on these features using the <code class="docutils literal"><span class="pre">predict</span></code>
method of the <code class="docutils literal"><span class="pre">scikit-learn</span></code> model.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="n">preds_cesium</span> <span class="o">=</span> <span class="n">model_cesium</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fset_cesium</span><span class="p">)</span>
<span class="n">preds_guo</span> <span class="o">=</span> <span class="n">model_guo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fset_guo</span><span class="p">)</span>
<span class="n">preds_dwt</span> <span class="o">=</span> <span class="n">model_dwt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">fset_dwt</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Built-in cesium features: training accuracy={:.2%}, test accuracy={:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_cesium</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_cesium</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Guo et al. features: training accuracy={:.2%}, test accuracy={:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_guo</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_guo</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Wavelet transform features: training accuracy={:.2%}, test accuracy={:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_dwt</span><span class="p">[</span><span class="n">train</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">train</span><span class="p">]),</span>
          <span class="n">accuracy_score</span><span class="p">(</span><span class="n">preds_dwt</span><span class="p">[</span><span class="n">test</span><span class="p">],</span> <span class="n">eeg</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">][</span><span class="n">test</span><span class="p">])))</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">Built</span><span class="o">-</span><span class="ow">in</span> <span class="n">cesium</span> <span class="n">features</span><span class="p">:</span> <span class="n">training</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">100.00</span><span class="o">%</span><span class="p">,</span> <span class="n">test</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">83.20</span><span class="o">%</span>
<span class="n">Guo</span> <span class="n">et</span> <span class="n">al</span><span class="o">.</span> <span class="n">features</span><span class="p">:</span> <span class="n">training</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">92.80</span><span class="o">%</span><span class="p">,</span> <span class="n">test</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">83.20</span><span class="o">%</span>
<span class="n">Wavelet</span> <span class="n">transform</span> <span class="n">features</span><span class="p">:</span> <span class="n">training</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">97.87</span><span class="o">%</span><span class="p">,</span> <span class="n">test</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">95.20</span><span class="o">%</span>
</pre></div>
</div>
<p>The workflow presented here is intentionally simplistic and omits many important steps
such as feature selection, model parameter selection, etc., which may all be
incorporated just as they would for any other <code class="docutils literal"><span class="pre">scikit-learn</span></code> analysis.
But with essentially three function calls (<code class="docutils literal"><span class="pre">featurize_time_series</span></code>,
<code class="docutils literal"><span class="pre">model.fit</span></code>, and <code class="docutils literal"><span class="pre">model.predict</span></code>), we are able to build a
model from a set of time series and make predictions on new, unlabeled data. In
upcoming posts we’ll introduce the web frontend for <code class="docutils literal"><span class="pre">cesium</span></code> and describe how
the same analysis can be performed in a browser with no setup or coding required.</p>
<p><strong>Total running time of the script:</strong> ( 0 minutes  51.251 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_EEG_Example.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_EEG_Example.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_EEG_Example.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_EEG_Example.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, The cesium Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'vUndefined',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>